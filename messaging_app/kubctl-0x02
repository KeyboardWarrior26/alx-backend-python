#!/bin/bash

# kubctl-0x02.sh â€” Blue-Green Deployment script

echo "ğŸš€ Applying blue (current stable) deployment..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Applying green (new candidate) deployment..."
kubectl apply -f green_deployment.yaml

echo "ğŸ“ Checking logs of green pods for errors..."

# Get pod names for green deployment
GREEN_PODS=$(kubectl get pods -l app=django-app,version=green -o jsonpath="{.items[*].metadata.name}")

for pod in $GREEN_PODS; do
    echo "ğŸ“¦ Logs for pod: $pod"
    kubectl logs $pod | grep -i error || echo "âœ… No errors found in $pod"
done

echo "ğŸ“¡ To switch traffic to green, update 'version' in kubeservice.yaml from blue âœ green and reapply:"
echo "kubectl apply -f kubeservice.yaml"
